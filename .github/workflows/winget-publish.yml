name: Publish to Winget

on:
  release:
    types: [published]
  workflow_dispatch:
    inputs:
      version:
        description: 'Version to publish (e.g., 0.0.2)'
        required: true
        type: string

permissions:
  contents: read

jobs:
  publish:
    runs-on: windows-latest
    
    steps:
    - name: Get version from release or input
      id: get-version
      shell: pwsh
      run: |
        if ('${{ github.event_name }}' -eq 'release') {
          $version = '${{ github.event.release.tag_name }}'.TrimStart('v')
        } else {
          $version = '${{ inputs.version }}'
        }
        echo "VERSION=$version" >> $env:GITHUB_OUTPUT
        echo "Publishing version: $version"

    - name: Publish to Winget
      uses: vedantmgoyal2009/winget-releaser@v2
      with:
        identifier: ScottHanselman.MaximizeToVirtualDesktop
        version: ${{ steps.get-version.outputs.VERSION }}
        installers-regex: '\.zip$'
        token: ${{ secrets.WINGET_TOKEN }}
